# Web Crawler NodeJs

ä¸€ä¸ªåŸºäº Node.js å’Œ Puppeteer çš„ç½‘é¡µå›¾ç‰‡çˆ¬è™«å·¥å…·ã€‚

## ç‰¹æ€§

âœ… **æ™ºèƒ½å›¾ç‰‡æå–**ï¼šè‡ªåŠ¨è¯†åˆ«å’Œæå–ç½‘é¡µä¸­çš„å›¾ç‰‡é“¾æ¥  
âœ… **å¤šç§ä¸‹è½½æ–¹å¼**ï¼šæ”¯æŒ Puppeteer å’Œ Axios ä¸¤ç§ä¸‹è½½æ–¹å¼  
âœ… **æ™ºèƒ½Fallbackæœºåˆ¶**ï¼šPuppeteerä¸‹è½½å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°Axiosï¼Œæå‡æˆåŠŸç‡  
âœ… **æ ¼å¼è½¬æ¢**ï¼šè‡ªåŠ¨å°† WebP æ ¼å¼è½¬æ¢ä¸º PNG  
âœ… **é˜²ä¸‹è½½å¼¹çª—**ï¼šè§£å†³ Puppeteer è®¿é—®å›¾ç‰‡é“¾æ¥æ—¶çš„ä¸‹è½½ç¡®è®¤å¼¹çª—é—®é¢˜  
âœ… **æ™ºèƒ½é‡è¯•æœºåˆ¶**ï¼šä¼˜é›…çš„å€’è®¡æ—¶æ˜¾ç¤ºï¼Œé¿å…æ—¥å¿—åˆ·å±  
âœ… **é«˜é¢œå€¼è¿›åº¦æ¡**ï¼šå®æ—¶æ˜¾ç¤ºä¸‹è½½è¿›åº¦ã€é€Ÿç‡ã€ETAç­‰ä¿¡æ¯  
âœ… **å¹¶å‘æ§åˆ¶**ï¼šå¯é…ç½®çš„å¹¶å‘ä¸‹è½½æ•°é‡  

## é¡¹ç›®è®¾ç½®

```bash
npm install
```

## è¿è¡Œ

### å¼€å‘æ¨¡å¼
```bash
npm run serve
```

### æµ‹è¯•é‡è¯•å€’è®¡æ—¶åŠŸèƒ½
```bash
node test-retry-countdown.js
```

## é‡è¦ç‰¹æ€§

### ğŸš€ æ™ºèƒ½Fallbackæœºåˆ¶

å½“Puppeteerä¸‹è½½å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°Axiosè¿›è¡Œä¸‹è½½ï¼Œæ˜¾è‘—æå‡ä¸‹è½½æˆåŠŸç‡ï¼š

**å·¥ä½œåŸç†ï¼š**
- âœ… ä¼˜å…ˆä½¿ç”¨Puppeteerä¸‹è½½ï¼ˆæ”¯æŒå¤æ‚é¡µé¢æ¸²æŸ“ï¼‰
- âœ… æ£€æµ‹å„ç§å¤±è´¥åœºæ™¯ï¼š`net::ERR_ABORTED`ã€è¿æ¥é”™è¯¯ã€è¶…æ—¶ç­‰
- âœ… å¤±è´¥æ—¶è‡ªåŠ¨fallbackåˆ°Axiosä¸‹è½½åŒä¸€URL
- âœ… åªæœ‰åŒé‡å¤±è´¥æ‰è®°å½•ä¸ºçœŸæ­£å¤±è´¥
- âœ… ä¸‹ä¸€ä¸ªURLä»ä¼˜å…ˆä½¿ç”¨Puppeteerï¼Œä¿æŒç­–ç•¥ä¸€è‡´æ€§

**æ”¯æŒçš„é”™è¯¯ç±»å‹ï¼š**
```
net::ERR_ABORTED                    // è¿æ¥ä¸­æ–­
net::ERR_CONNECTION_CLOSED          // è¿æ¥å…³é—­  
Navigation timeout exceeded         // å¯¼èˆªè¶…æ—¶
Could not load body for request     // è¯·æ±‚ä½“åŠ è½½å¤±è´¥
```

**æµ‹è¯•éªŒè¯ï¼š**
```bash
node test-puppeteer-axios-fallback.js  # åŸºç¡€åŠŸèƒ½æµ‹è¯•
node test-fallback-specific.js         # ç‰¹å®šé”™è¯¯åœºæ™¯æµ‹è¯•
```

### ğŸ”„ ä¼˜é›…çš„é‡è¯•å€’è®¡æ—¶

é‡æ–°è®¾è®¡äº†é‡è¯•æœºåˆ¶ï¼Œä½¿ç”¨ `process.stdout.write` æ›¿ä»£ä¼ ç»Ÿæ—¥å¿—è¾“å‡ºï¼š

**ä¼˜ç‚¹ï¼š**
- âœ… åœ¨åŒä¸€è¡Œæ˜¾ç¤ºå€’è®¡æ—¶ï¼Œé¿å…åˆ·å±
- âœ… å½©è‰²æ–‡å­—æç¤ºï¼Œæ›´åŠ ç¾è§‚
- âœ… æ˜¾ç¤ºé‡è¯•æ¬¡æ•°è¿›åº¦ï¼ˆç¬¬X/Yæ¬¡ï¼‰
- âœ… å€’è®¡æ—¶ç»“æŸè‡ªåŠ¨æ¸…ç†è¾“å‡ºè¡Œ

**ç¤ºä¾‹æ•ˆæœï¼š**
```
ğŸ”„ é‡è¯•å€’è®¡æ—¶ (ç¬¬1/3æ¬¡): 5s
```

### ğŸ“Š é«˜é¢œå€¼è¿›åº¦æ¡

é›†æˆ cli-progress åº“ï¼Œæä¾›ä¸“ä¸šçº§çš„è¿›åº¦æ¡æ˜¾ç¤ºï¼š

- âœ… å®æ—¶æ›´æ–°ä¸‹è½½è¿›åº¦
- âœ… æ˜¾ç¤ºä¸‹è½½é€Ÿç‡ã€ETAã€æˆåŠŸç‡
- âœ… é›¶åˆ·å±è®¾è®¡ï¼Œä¼˜é›…çš„ç”¨æˆ·ä½“éªŒ
- âœ… å¯é…ç½®æ›´æ–°é¢‘ç‡ï¼ˆrealtime/fast/normal/slowï¼‰

### Puppeteer ä¸‹è½½å¼¹çª—é—®é¢˜

å½“è®¿é—®æŸäº›å›¾ç‰‡é“¾æ¥æ—¶ï¼Œå¦‚æœé“¾æ¥ä¼šç›´æ¥è§¦å‘æ–‡ä»¶ä¸‹è½½ï¼Œæµè§ˆå™¨ä¼šå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ã€‚æœ¬é¡¹ç›®å·²è§£å†³æ­¤é—®é¢˜ï¼š

- **æµè§ˆå™¨å¯åŠ¨ä¼˜åŒ–**ï¼šæ·»åŠ ç¦ç”¨ä¸‹è½½çš„å¯åŠ¨å‚æ•°
- **è¯·æ±‚æ‹¦æˆª**ï¼šè®¾ç½®è¯·æ±‚æ‹¦æˆªé¿å…è§¦å‘ä¸‹è½½
- **ä¼˜é›…å…³é—­**ï¼šå®ç°æµè§ˆå™¨çš„ä¼˜é›…å…³é—­æœºåˆ¶
- **ç‹¬ç«‹ä¸‹è½½é¡µé¢**ï¼šä¸ºæ¯ä¸ªå›¾ç‰‡ä¸‹è½½åˆ›å»ºç‹¬ç«‹é¡µé¢

è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒï¼š[PUPPETEER_DOWNLOAD_FIX.md](./PUPPETEER_DOWNLOAD_FIX.md)

## é…ç½®è¯´æ˜

ä¸»è¦é…ç½®æ–‡ä»¶ï¼š`src/config.js`

```javascript
const config = {
  extractMode: 'singleSite',           // è§£ææ¨¡å¼
  downloadMode: 'downloadAllImages',   // ä¸‹è½½æ¨¡å¼  
  url: 'https://example.com',          // ç›®æ ‡ç½‘ç«™
  retryInterval: 5,                    // é‡è¯•é—´éš”(ç§’)
  retriesCount: 1,                     // é‡è¯•æ¬¡æ•°
  maxConcurrentRequests: 50,           // æœ€å¤§å¹¶å‘æ•°
  maxIntervalMs: 1000,                 // æœ€å¤§è¯·æ±‚é—´éš”
  minIntervalMs: 100,                  // æœ€å°è¯·æ±‚é—´éš”
  downloadFolderPath: '',              // ä¸‹è½½æ–‡ä»¶å¤¹è·¯å¾„
  logLevel: 'info',                    // æ—¥å¿—çº§åˆ«
  enableProgressBar: true,             // å¯ç”¨è¿›åº¦æ¡
  progressUpdateFrequency: 'realtime', // è¿›åº¦æ¡æ›´æ–°é¢‘ç‡
}
```

## å·¥å…·ç±»

### RetryCountdown é‡è¯•å€’è®¡æ—¶å·¥å…·

ä½ç½®ï¼š`src/utils/RetryCountdown.js`

**åŠŸèƒ½ï¼š**
- æä¾›ä¼˜é›…çš„å€’è®¡æ—¶æ˜¾ç¤º
- æ”¯æŒè‡ªå®šä¹‰é¢œè‰²å’Œå‰ç¼€æ–‡å­—
- è‡ªåŠ¨æ¸…ç†è¾“å‡ºè¡Œ
- æ”¯æŒå¼‚æ­¥å›è°ƒæ“ä½œ

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```javascript
import { RetryCountdown } from './src/utils/RetryCountdown.js'

// å¿«é€Ÿä½¿ç”¨
await RetryCountdown.countdown(5, () => {
  console.log('é‡è¯•æ“ä½œ!')
})

// è‡ªå®šä¹‰æ ·å¼
await RetryCountdown.countdown(10, async () => {
  await performRetry()
}, {
  prefix: 'ğŸ”„ è‡ªå®šä¹‰é‡è¯•å€’è®¡æ—¶',
  color: '\x1b[36m' // é’è‰²
})
```
